{% extends "base.html" %}

{% block content %}
{% if error %}
<div class="lobby-alert" role="alert">{{ error }}</div>
{% endif %}

<section class="lobby-section">
    <div class="lobby-section-header">
        <h2>Open Tables</h2>
        <small class="lobby-table-count">{{ rooms|length }} active</small>
    </div>

    <div class="lobby-grid">
        <form method="POST" action="/rooms/new" class="lobby-create-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="lobby-create-btn">
                <span class="lobby-create-icon">+</span>
                <span class="lobby-create-label">New Table</span>
            </button>
        </form>

        {% for room in rooms %}
        <article class="lobby-room-card" style="--card-index: {{ loop.index0 }}">
            <div class="lobby-room-header">
                <code class="lobby-room-id">{{ room.room_id }}</code>
                <span class="lobby-room-count">{{ room.player_count }}/{{ room.players_needed }}</span>
            </div>
            <div class="lobby-table-vis">
                {% for i in range(room.players_needed) %}
                <span class="lobby-seat {{ 'filled' if i < room.player_count else '' }}"></span>
                {% endfor %}
            </div>
            {% if room.player_count < room.players_needed %}
            <form method="POST" action="/rooms/{{ room.room_id }}/join">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <button type="submit" class="outline lobby-join-btn">Join Table</button>
            </form>
            {% else %}
            <span class="lobby-full-badge">Full</span>
            {% endif %}
        </article>
        {% endfor %}
    </div>

    {% if not rooms %}
    <div class="lobby-empty">
        <p>No tables yet</p>
        <p><small>Create one to start playing</small></p>
    </div>
    {% endif %}
</section>
{% endblock %}
